ECHO Stage 3 (Collective) — Carbon-aware EV charging
====================================================

Goal: craft executable heuristics that coordinate five households to minimize the
weighted transformer overload and carbon term.

Global objective
----------------
For joint allocation a (length 5):
    feeder_penalty = max_t max(0, baseline[t] + EV_count[t] − capacity)
    carbon_term = sum_t carbon_intensity[t] for every EV assigned to slot t
    score(a) = α * feeder_penalty + β * carbon_term

Parameters
----------
Scenario id: ev_peak_sharing_1
Slots (index → hour): 0: 19-20, 1: 20-21, 2: 21-22, 3: 22-23
Feeder capacity: 7.0
Baseline load: 5.2, 5.6, 5.0, 6.7
Carbon intensity: 560, 500, 520, 420
Weights: α=40.00, β=0.50

Agent context
-------------
Agent 1 (Budget-sensitive engineer with a solar-equipped townhouse)
  Base demand: [1.1, 0.8, 0.7, 0.6]
  Preferred slots: [1, 3]
  Comfort penalty: 0.16
  Neighbor ICL:
    - Example with neighbor 2: slot 1 (Neighbor moved earlier to ride lower price despite mild carbon bump)
    - Example with neighbor 2: slot 0 (On feeder warning day neighbor took earliest slot to protect 21-22h peak)

Agent 2 (Grid analyst who cares about transformer life)
  Base demand: [0.6, 1.0, 0.7, 0.5]
  Preferred slots: [0, 1]
  Comfort penalty: 0.12
  Neighbor ICL:
    - Example with neighbor 1: slot 1 (Neighbor slides to 20-21h when price gap widens)
    - Example with neighbor 3: slot 2 (Central neighbor sticks to 21-22h unless carbon spikes)

Agent 3 (Night-shift nurse who values rest and reliability)
  Base demand: [0.7, 0.9, 0.8, 0.6]
  Preferred slots: [2]
  Comfort penalty: 0.22
  Neighbor ICL:
    - Example with neighbor 2: slot 1 (Upstream neighbor leans on 20-21h when feeder is loose)
    - Example with neighbor 4: slot 3 (Downstream neighbor absorbs late slot to dodge carbon)

Agent 4 (Retired couple monitoring comfort and bills)
  Base demand: [0.8, 0.7, 0.6, 0.9]
  Preferred slots: [3]
  Comfort penalty: 0.16
  Neighbor ICL:
    - Example with neighbor 3: slot 2 (Central neighbor anchors on 21-22h to keep routine)
    - Example with neighbor 5: slot 3 (Downstream neighbor also favors final slot when peak warning issued)

Agent 5 (Student tenant juggling late classes)
  Base demand: [0.5, 0.6, 0.7, 0.8]
  Preferred slots: [3]
  Comfort penalty: 0.1
  Neighbor ICL:
    - Example with neighbor 4: slot 3 (Upstream neighbor usually sits at 22-23h unless feeder alarms)
    - Example with neighbor 4: slot 2 (On price spike nights upstream shifts to 21-22h to dodge carbon)

Output specification
--------------------
Write Python that loads scenario.json, simulates your heuristic, and writes
`global_policy_output.json` containing the chosen slot for each agent.

Scoring
-------
Fitness = −score(a). Lower global cost is better, with hard preference for staying below capacity.

